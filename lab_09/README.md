# Отсечение произвольного многоугольника выпуклым отсекателем. (Алгоритм Сазерленда-Ходжмена)

Данный алгоритм позволяет отсекать выпуклым отсекателем многоугольники.

Пусть, многоугольник задаётся вершинами Pi, где i = 1…np, а выпуклый отсекатель Cj, j = 1…nc. Для каждой стороны отсекателя производится отсечение и перезаписывается список вершин многоугольника и затем получаем результирующий многоугольник, вершины которого будут располагаться по видимую сторону от очередной стороны отсекателя. 

В ходе работы алгоритма, возможны 4 случая расположения стороны отсекателя и отсекаемого многоугольника:

### 1. Сторона многоугольника находится полностью по видимую сторону отсекателя и является полностью видимой. 

В список вершин вносится вершина Pi, Pi – 1 уже занесена в список, т.е. сторона будет занесена в список без изменений.

### 2. Сторона многоугольника находится полностью по невидимую сторону отсекателя и является полностью невидимой.

В список вершин ничего не вносится.

### 3. Сторону многоульника видно частично, где точка Pi - 1 невидима, а Pi видима, т.е. сторона входит внутрь отсекателя.

Необходимо найти вершину пересечения ребра многоугольника и занести в список, вершина Pi также будет видима и будет занесена в список.

### 4. Сторону многоульника видно частично, где точка Pi - 1 видима, а Pi невидима, т.е. сторона выходит из области отсекателя.

Необходимо найти точку пересечения ребра многоугольника и занести в список, вершина Pi – 1 уже находится в списке.

Для проверки видимости точки относительно ребра можно воспользоваться способом, который предложили авторы алгоритма: пусть, точки A1 и A2 лежат на ребре отсекателя, а точка A3 является пробной. Тогда для проверки видимости пробной точки необходимо получить направление по оси z  векторного произведения A1A3 * A1A2. Т.к. обход идёт по часовой стрелке, видимыми будут те точки, для которых эта компонента меньше нуля.

Для нахождения точки пересечения можно использовать алгоритм Кируса-Бека. Уравнение ребра многоугольника можно представить в параметрическом виде и рассмотреть вектор ориентации стороны отсекателя. В случае  нахождения пересечения проверяется валидность значения и добавляется в список вершин в случае корректности значения.


# Возможные вопросы на защиту и попытка на них ответить

#### 1. Можно ли на промежуточных этапах установить невидимость многоугольника?

Можно, если многоугольник окажется невидимым относительно одной из сторон отсекателя, то он окажется невидимым для всего отсекателя. Вершины многоугольника окажутся невидимыми относительно этой стороны, а следовательно массив вершин, результирующего многоугольника, окажется пустым.

#### 2. Какой недостаток имеет алгоритм, когда он возникает?

В случае, когда многоугольник, в ходе отсечения, разделяется отсекателем на несколько, могут возникнуть ложные рёбра. Такие рёбра проходят по границе отсекателя и соединяют результирующие многоугольники.

![](https://sun9-27.userapi.com/wAe8V5T7fr45gr1CVRHxq2mQEjkTcqaYQ-K2-A/JmXXPt8RKTs.jpg)

#### 3. Для данных, приведенных на рис. в файле, покажите результат и объясните его (вопрос в условиях дистанта, может быть не задаст, а может и задаст).

![](https://sun9-45.userapi.com/zgV5mUScXkh3WC9C3ndFnB-xzAG2Wkk_qAAdMw/lFCjtFfphr4.jpg)

Пусть C - отсекатель, а P - отсекаемый многоугольник, тогда:

- Сторона C1C2:
    - P1 - невидима и не заносится в массив
    - P2 - невидима и не заносится в массив
    - P3 - видима, ребро P2P3 имеет разную видимость вершин, производим поиск точки пересечения, затем заносится точка пересечения и P3 в массив
    - P4, P5, P6, P7, P8, P9, P10, P11 - видимы и заносятся в массив
    - Ребро P1P11 имеет разную видимость вершин, производим поиск точки пересечения, заносим точку пересечения в результат

- Сторона C2C3
    - P1 - видима и заносится в массив
    - P2 - невидима. Ребро P1P2 имеет разную видимость вершин, производим поиск точки пересечения, заносим точку пересечения в массив
    - P3 - невидима и не заносится в массив
    - P4 - невидима и не заносится в массив
    - P5 - видима. Ребро P4P5 имеет разную видимость вершин, производим поиск точки пересечения, заносим точку пересечения и P5 в массив
    - P6 - невидима. Ребро P5P6 имеет разную видимость вершин, производим поиск точки пересечения, заносим точку пересечения в массив
    - P7 - видима. Ребро P6P7 имеет разную видимость вершин, производим поиск точки пересечения, заносим точку пересечения и P7 в массив 
    - P8 - видима, P9 - видима, P10 - видима заносим в массив. В ребре P10P1 видимость точек не меняется, они уже занесены в результат

- Сторона С3С4
    - P1 - видима и заносится в массив
    - P2 - видима и заносится в массив
    - P3 - невидима. Ребро P2P3 имеет разную видимость вершин, производим поиск точки пересечения, заносим точку пересечения в массив.
    - P4 - видима. Ребро P3P4 имеет разную видимость вершин, производим поиск точки пересечения, заносим точку пересечения и P4 в массив
    - P5, P6, P7, P8, P9 - видимы заносим в массив

- Сторона С4С1
    - Все вершины видимы относительно данной стороны отсекателя и будут занесены в результирующий массив.

Получаем следующий результат:

![](https://sun9-8.userapi.com/Ssp4x1Ve-Rjg8P-uvqmVMJa6O_ryozmfuzO-jw/PI1nddQUtgQ.jpg)

#### 4. Пересечение каких геом. объектов вы ищете?

В данном алгоритме рассматривается пересечение рёбер отсекателя с рёбрами отсекаемого многоугольника.

#### 5. Как решается задача, если многоугольники не пересекаются?

В том случае, если пересечений отсекателя с многоугольником нет, то многоугольник находится либо вне отсекателя, либо внутри него.

В первом случае, многоугольник окажется целиком невидимым для одной из сторон отсекателя и ни одна вершина многоугольника, на текущей итерации, не поместится в массив вершин результирующего многоугольника и массив окажется пустым. 

В случае, когда многоугольник находится внутри отсекателя, каждая вершина многоугольника окажется видна для каждой стороны отсекателя и тогда вершины будут вноситься в результирующий массив без изменений на каждой итерации цикла.

#### 6. Как определяли видимость точек?

Видимость точки относительно очередной стороны отсекателя определяется с помощью векторного произведения векторов. Допустим, A1A2 - вектор ориентации ребра, а A1A3 - вектор идущий к пробной точке. Посчитав векторное произведение (A1A3 * A1A2), получим, в качестве результата, отличную компоненту - z (т.к. вектора лежат в одной плоскости). В случае z больше 0 - точка будет находится справа от стороны отсекателя и, следовательно, лежит внутри видимой области (в случае обхода по часовой стрелке, где, при таком обходе, область видимости будет находится справа от стороны отскателя).
